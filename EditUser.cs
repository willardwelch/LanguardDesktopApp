using System;using System.Collections.Generic;using System.ComponentModel;using System.Data;using System.Drawing;using System.Linq;using System.Text;using System.Data.SqlClient;using System.Threading.Tasks;using System.Windows.Forms;using System.IdentityModel.Claims;using System.Drawing.Drawing2D;namespace ReportingSystem{    public partial class EditUser : Form    {               public EditUser()        {            InitializeComponent();        }        private void EditUser_Load(object sender, EventArgs e)        {            LoadUsertoDataGrid();            LoadBrigade();            LoadUnit();            LoadCoy();        }        private void radioButton2_CheckedChanged(object sender, EventArgs e)        {            this.Brigade.Visible = true;            this.Brigade.Enabled = true;            label5.Visible = false;            label6.Visible = false;            this.cmbUnit1.Visible = false;            this.cmbCoy.Visible = false;            ConnectData.Userrights = radioButton2.Text;            LoadBrigade();        }        private void LoadBrigade()        {                                  if (ConnectData.createRights == "Administrator")            {                var dataset = ConnectData.insert_info.sp_selectBrigade();                cmbBrigade.ValueMember = "ID";                cmbBrigade.DisplayMember = "Brigade";                cmbBrigade.DataSource = dataset;            }            else            {                var dataset = ConnectData.insert_info.sp_selectBrigadebyBde(ConnectData.bdeLevelAccess);                cmbBrigade.ValueMember = "ID";                cmbBrigade.DisplayMember = "Brigade";                cmbBrigade.DataSource = dataset;            }            cmbUnit1.Refresh();            cmbCoy.Refresh();            // Close connection            LoadUnit();        }        private void radioButton1_CheckedChanged(object sender, EventArgs e)        {            this.Brigade.Visible = false;            ConnectData.Userrights = radioButton1.Text;            LoadBrigade();        }        private void radioButton3_CheckedChanged(object sender, EventArgs e)        {            this.Brigade.Visible = true;            this.Brigade.Enabled = true;            label5.Visible = true;            label6.Visible = false;            this.cmbUnit1.Visible = true;            this.cmbUnit1.Enabled = true;            this.cmbCoy.Visible = false;            ConnectData.Userrights = radioButton3.Text;            LoadBrigade();        }        private void radioButton4_CheckedChanged(object sender, EventArgs e)        {            this.Brigade.Visible = true;            this.Brigade.Enabled = true;            label5.Visible = true;            label6.Visible = true;            this.cmbUnit1.Visible = true;            this.cmbUnit1.Enabled = true;            this.cmbCoy.Visible = true;            this.cmbCoy.Enabled = true;            ConnectData.Userrights = radioButton4.Text;            LoadBrigade();            //LoadCoy();        }        private void cmbBrigade_SelectedIndexChanged(object sender, EventArgs e)        {            LoadUnit();        }        private void LoadUnit()        {            if (this.cmbBrigade.SelectedValue.ToString() != null)            {                int BrigadeId = int.Parse(this.cmbBrigade.SelectedValue.ToString());                                 var dataset = ConnectData.insert_info.sp_selectUnit(BrigadeId);                                        this.cmbUnit1.ValueMember = "id";                    this.cmbUnit1.DisplayMember = "Unit";                   this.cmbUnit1.DataSource = dataset;                this.cmbUnit1.Refresh();                            }                       //    LoadCoy();        }        private void button2_Click_1(object sender, EventArgs e)        {            this.Close();        }        private void button1_Click_1(object sender, EventArgs e)        {                   }        private void LoadCoy()        {            try            {              //  SqlConnection connDb = new SqlConnection(ConnectData.connectionString);              //  connDb.Open();                int unitID = int.Parse(this.cmbUnit1.SelectedValue.ToString());                int BdeID = int.Parse(this.cmbBrigade.SelectedValue.ToString());                if (this.cmbUnit1.Text != null)                {                                      var dataset = ConnectData.insert_info.sp_selectCoy( BdeID, unitID);                    this.cmbCoy.ValueMember = "ID";                    this.cmbCoy.DisplayMember = "CoyName";                    this.cmbCoy.DataSource = dataset;                }               // connDb.Close();            }            catch (Exception ex)            {                MessageBox.Show(ex.Message, "Error as occurred",MessageBoxButtons.OK);            }        }        private void cmbUnit1_SelectedIndexChanged(object sender, EventArgs e)        {            ///if (cmbCoy.Visible == true)            LoadCoy();        }        private void cmbCoy_SelectedIndexChanged(object sender, EventArgs e)        {        }        private void UpdateUserRecord()        {            ConnectData.createUserName = txtUserName.Text;            ConnectData.message = "Record Updated Successfully";            ConnectData.title = "Save";            int recordCount = 0;                /*   using (SqlConnection con = new SqlConnection(ConnectData.connectionString))                    {                        using (SqlCommand cmd = new SqlCommand("sp_EditUser", con))                        {                            cmd.CommandType = CommandType.StoredProcedure;                            cmd.Parameters.Add("@UserName", SqlDbType.VarChar).Value = ConnectData.createUserName;                            cmd.Parameters.Add("@UserPassword", SqlDbType.VarChar).Value = txtPassword.Text;                            cmd.Parameters.Add("@Rights", SqlDbType.VarChar).Value = ConnectData.Userrights;                         */                           if (ConnectData.Userrights == "Administrator")                            {                                /*  cmd.Parameters.Add("@BrigadeLevel", SqlDbType.Int).Value = 0;                                  cmd.Parameters.Add("@UnitLevel", SqlDbType.Int).Value = 0;                                  cmd.Parameters.Add("@CoyLevel", SqlDbType.Int).Value = 0;*/                                var dataset = ConnectData.insert_info.sp_EditUser(ConnectData.createUserName, txtPassword.Text, ConnectData.Userrights,0,0,0);                                 recordCount = dataset;                             }                         if (ConnectData.Userrights == "Brigade")                            {                              /*  cmd.Parameters.Add("@BrigadeLevel", SqlDbType.Int).Value = (int)this.cmbBrigade.SelectedValue;                                cmd.Parameters.Add("@UnitLevel", SqlDbType.Int).Value = 0;                                cmd.Parameters.Add("@CoyLevel", SqlDbType.Int).Value = 0;                              */                                 var dataset = ConnectData.insert_info.sp_EditUser(ConnectData.createUserName, txtPassword.Text, ConnectData.Userrights, (int)this.cmbBrigade.SelectedValue, 0, 0);                                    recordCount = dataset;                            }                          if (ConnectData.Userrights == "Unit")                            {                                /*    cmd.Parameters.Add("@BrigadeLevel", SqlDbType.Int).Value = (int)this.cmbBrigade.SelectedValue;                                    cmd.Parameters.Add("@UnitLevel", SqlDbType.Int).Value = (int)this.cmbUnit1.SelectedValue;                                    cmd.Parameters.Add("@CoyLevel", SqlDbType.Int).Value = 0;                                */                                var dataset = ConnectData.insert_info.sp_EditUser(ConnectData.createUserName, txtPassword.Text, ConnectData.Userrights, (int)this.cmbBrigade.SelectedValue, (int)this.cmbUnit1.SelectedValue, 0);                                recordCount = dataset;                            }                                                        if (ConnectData.Userrights == "Company")                            {                                /* cmd.Parameters.Add("@BrigadeLevel", SqlDbType.Int).Value = (int)this.cmbBrigade.SelectedValue;                                 cmd.Parameters.Add("@UnitLevel", SqlDbType.Int).Value = (int)this.cmbUnit1.SelectedValue;                                 cmd.Parameters.Add("@CoyLevel", SqlDbType.Int).Value = (int)this.cmbCoy.SelectedValue;*/                                var dataset = ConnectData.insert_info.sp_EditUser(ConnectData.createUserName, txtPassword.Text, ConnectData.Userrights, (int)this.cmbBrigade.SelectedValue, (int)this.cmbUnit1.SelectedValue, (int)this.cmbCoy.SelectedValue);                                recordCount = dataset;                            }                             try                             {                                    if (recordCount > 1)                                    {                                        ConnectData.message = "User already  exist!";                                        ConnectData.title = "Save Failed";                                        MessageBox.Show(ConnectData.message, ConnectData.title);                                    }                                    else                                    {                                        MessageBox.Show(ConnectData.message, ConnectData.title);                                        txtUserName.Text = "";                                    }                              }//end of try                            catch(Exception mes)                                {                                        MessageBox.Show(mes.Message, "Issues");                                 }        }        public void LoadUsertoDataGrid()        {            //SqlConnection connDb = new SqlConnection(ConnectData.connectionString);           // connDb.Open();          //    groupBox1.Visible = false;            groupBox2.Visible = false;          //  var command = new SqlCommand("sp_SelectUser", connDb);                // Set command type and add Parameters               // command.CommandType = CommandType.StoredProcedure;                // Execute command in Adapter and store to datatable               // var adapter = new SqlDataAdapter(command);               // DataTable de = new DataTable();            var dataset = ConnectData.insert_info.sp_SelectUser().ToList();                               dataGridView1.DataSource = dataset;                      dataGridView1.Visible = true;                    dataGridView1.Columns[0].Visible = true;                    dataGridView1.Columns[1].Visible = false;                    dataGridView1.Columns[2].Visible = false;                    dataGridView1.Columns[3].Visible = false;                    dataGridView1.Columns[4].Visible = false;                    dataGridView1.Columns[5].Visible = false;                           }        private void dataGridView1_CellContentClick(object sender, DataGridViewCellEventArgs e)        {            string rights = "";            if (e.RowIndex > -1)            {                groupBox2.Visible = true;                Brigade.Visible = true;                txtUserName.Text = this.dataGridView1[0, e.RowIndex].Value.ToString();                rights = this.dataGridView1[2, e.RowIndex].Value.ToString();                if (rights == radioButton1.Text)                    radioButton1.Checked = true;                if (rights == radioButton2.Text)                    radioButton2.Checked = true;                if (rights == radioButton3.Text)                    radioButton3.Checked = true;                if (rights == radioButton4.Text)                    radioButton4.Checked = true;              /*  txtLastName.Text = this.dataGridView1[2, e.RowIndex].Value.ToString();                cmbMStatus.Text = this.dataGridView1[3, e.RowIndex].Value.ToString();                cmbGender.Text = this.dataGridView1[4, e.RowIndex].Value.ToString();                txtDOB.Text = this.dataGridView1[5, e.RowIndex].Value.ToString();                txtDOE.Text = this.dataGridView1[6, e.RowIndex].Value.ToString();                txtRod.Text = this.dataGridView1[7, e.RowIndex].Value.ToString();                txtAddress.Text = this.dataGridView1[8, e.RowIndex].Value.ToString();                cmbParish.Text = this.dataGridView1[9, e.RowIndex].Value.ToString();                cmbParish.Text = this.dataGridView1[8, e.RowIndex].Value.ToString();*/            }        }        private void dataGridView1_Click(object sender, EventArgs e)        {        }        private void dataGridView1_CellMouseClick(object sender, DataGridViewCellMouseEventArgs e)        {            if (e.RowIndex > -1)            {                string rights;                groupBox2.Visible = true;                Brigade.Visible = true;                txtPassword.Text= this.dataGridView1[1, e.RowIndex].Value.ToString();                txtUserName.Text = this.dataGridView1[0, e.RowIndex].Value.ToString();                rights = this.dataGridView1[2, e.RowIndex].Value.ToString();                if (rights == radioButton1.Text)  //Administrator                {                    radioButton1.Checked = true;                    label4.Visible = false;                    cmbBrigade.Visible = false;                    Brigade.Visible = false;                    label5.Visible = false;                    cmbUnit1.Visible = false;                    label6.Visible = false;                    cmbCoy.Visible = false;                }                if (rights == radioButton2.Text) //Brigade User                {                    radioButton2.Checked = true;                    getBrigadeName(int.Parse(this.dataGridView1[3, e.RowIndex].Value.ToString()));                    label4.Visible = true;                    cmbBrigade.Visible = true;                    label5.Visible = false;                    cmbUnit1.Visible = false;                    label6.Visible = false;                    cmbCoy.Visible = false;                }                if (rights == radioButton3.Text) //Unit User                {                    radioButton3.Checked = true;                    getBrigadeName(int.Parse(this.dataGridView1[3, e.RowIndex].Value.ToString()));                    getUnitName(int.Parse(this.dataGridView1[3, e.RowIndex].Value.ToString()), int.Parse(this.dataGridView1[4, e.RowIndex].Value.ToString()));                    label4.Visible = true;                    cmbBrigade.Visible = true;                    label5.Visible = true;                    cmbUnit1.Visible = true;                    label6.Visible = false;                    cmbCoy.Visible = false;                }                if (rights == radioButton4.Text)  // Company User                {                    getBrigadeName(int.Parse(this.dataGridView1[3, e.RowIndex].Value.ToString()));                    getUnitName(int.Parse(this.dataGridView1[3, e.RowIndex].Value.ToString()), int.Parse(this.dataGridView1[4, e.RowIndex].Value.ToString()));                    radioButton4.Checked = true;                    label4.Visible = true;                    cmbBrigade.Visible = true;                    label5.Visible = true;                    cmbUnit1.Visible = true;                    label6.Visible = true;                    cmbCoy.Visible = true;                }            }        }        public void getBrigadeName(int bdeID)        {           
                var dataset = ConnectData.insert_info.sp_selectBrigadebyBde(bdeID);

                    this.cmbHideBrigade.ValueMember = "ID";                    this.cmbHideBrigade.DisplayMember = "Brigade";                    this.cmbHideBrigade.DataSource = dataset;

                    this.cmbHideBrigade.Refresh();                        cmbBrigade.SelectedValue = cmbHideBrigade.SelectedValue;                       }        public void getUnitName(int bdeID, int UnitdID)        {         
                var dataset = ConnectData.insert_info.sp_selectUnitbyID(bdeID, UnitdID);

                              cmbhideUnit.DisplayMember = "Unit";                cmbhideUnit.ValueMember = "ID";                cmbhideUnit.DataSource = dataset;                cmbUnit1.SelectedValue = cmbhideUnit.SelectedValue;               // cmd.ExecuteNonQuery();                   }        public void getCoyName(int bdeID, int UnitdID, int CoyID)        {           
                var dataset = ConnectData.insert_info.sp_selectCoybyID(UnitdID, bdeID, CoyID);

                cmbhidecoy.DisplayMember = "Company";                cmbhidecoy.ValueMember = "ID";                cmbhidecoy.DataSource = dataset;                cmbCoy.SelectedValue = cmbhidecoy.SelectedValue;                // cmd.ExecuteNonQuery();                 }        private void radioButton1_CheckedChanged_1(object sender, EventArgs e)        {            this.Brigade.Visible = false;            ConnectData.Userrights = radioButton1.Text;            LoadBrigade();        }        private void radioButton2_CheckedChanged_1(object sender, EventArgs e)        {            this.Brigade.Visible = true;            this.Brigade.Enabled = true;            label4.Visible = true;            label5.Visible = false;            label6.Visible = false;            cmbBrigade.Visible = true;            this.cmbUnit1.Visible = false;            this.cmbCoy.Visible = false;            ConnectData.Userrights = radioButton2.Text;            LoadBrigade();        }        private void radioButton3_CheckedChanged_1(object sender, EventArgs e)        {            this.Brigade.Visible = true;            this.Brigade.Enabled = true;            label5.Visible = true;            label6.Visible = false;            this.cmbUnit1.Visible = true;            this.cmbUnit1.Enabled = true;            this.cmbCoy.Visible = false;            ConnectData.Userrights = radioButton3.Text;            LoadBrigade();        }        private void radioButton4_CheckedChanged_1(object sender, EventArgs e)        {            this.Brigade.Visible = true;            this.Brigade.Enabled = true;            label5.Visible = true;            label6.Visible = true;            this.cmbUnit1.Visible = true;            this.cmbUnit1.Enabled = true;            this.cmbCoy.Visible = true;            this.cmbCoy.Enabled = true;            ConnectData.Userrights = radioButton4.Text;            LoadBrigade();        }        private void button1_Click(object sender, EventArgs e)        {            if (txtUserName.Text == "")            {                ConnectData.message = "Please select user ";                ConnectData.title = "User Name Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);               // txtUserName.Focus();            }            else if (ConnectData.Userrights == "")            {                ConnectData.message = "Please select user rights";                ConnectData.title = "User's Right Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if ((ConnectData.Userrights == "Brigade") && (cmbBrigade.Text == ""))            {                ConnectData.message = "Please select user brigade";                ConnectData.title = "User's brigade Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if ((ConnectData.Userrights == "Unit") && (cmbBrigade.Text == ""))            {                ConnectData.message = "Please select user brigade";                ConnectData.title = "User's brigade Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if ((ConnectData.Userrights == "Unit") && (cmbUnit1.Text == ""))            {                ConnectData.message = "Please select user's unit";                ConnectData.title = "User's unit is Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if ((ConnectData.Userrights == "Company") && (cmbBrigade.Text == ""))            {                ConnectData.message = "Please select user's brigade";                ConnectData.title = "User's brigade is Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if ((ConnectData.Userrights == "Company") && (cmbUnit1.Text == ""))            {                ConnectData.message = "Please select user's unit";                ConnectData.title = "User's unit is Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if ((ConnectData.Userrights == "Company") && (cmbCoy.Text == ""))            {                ConnectData.message = "Please select user's company";                ConnectData.title = "User's comnpany is Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if (txtPassword.Text == "")            {                ConnectData.message = "Please enter user's password";                ConnectData.title = "User's password is Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if (txtConfirmPassword.Text == "")            {                ConnectData.message = "Please confirm passsword is missing";                ConnectData.title = "confirm password is Missing";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else if ((txtPassword.Text != "") && (txtConfirmPassword.Text != "") && (txtPassword.Text != txtConfirmPassword.Text))            {                ConnectData.message = "Password does not match";                ConnectData.title = "password not match";                MessageBox.Show(ConnectData.message, ConnectData.title);            }            else            {                UpdateUserRecord();            }        }

        private void button2_Click(object sender, EventArgs e)
        {
            this.Close();
        }

        private void cmbBrigade_SelectedIndexChanged_1(object sender, EventArgs e)
        {
            LoadUnit();
        }

        private void cmbUnit1_SelectedIndexChanged_1(object sender, EventArgs e)
        {
            LoadCoy();
        }
    }}